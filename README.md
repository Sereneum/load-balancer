# Load Balancer Project

## Описание проекта

Этот проект представляет собой балансировщик нагрузки с поддержкой:

- Различных стратегий балансировки (пока только round-robin)

- Проверки состояния бэкенд-серверов (health checks)

- Ограничения скорости запросов (rate limiting)

- Горячей перезагрузки конфигурации

- Graceful Shutdown


## Сборка и запуск

### Требования

- Go 1.21+

- Установленные зависимости (загружаются автоматически при сборке)

### Запуск балансировщика

```bash
go run cmd/balancer/main.go -config <путь_к_конфигу>
```

Флаги:

- `-config` - путь к конфигурационному файлу (по умолчанию `configs/config.yaml`)

### Запуск мок-серверов

```bash
go run cmd/mockserver/main.go -config <путь_к_конфигу>
```
Флаги:

- `-config` - путь к конфигурационному файлу (по умолчанию `configs/config.yaml`)
## Конфигурация

Конфигурационный файл в формате YAML содержит следующие параметры:
```yaml
server:
  port: "8080"              # Порт для балансировщика
  read_timeout: 5s          # Таймаут чтения
  write_timeout: 10s        # Таймаут записи

strategy: "round-robin"     # Стратегия балансировки

backends:                   # Список бэкенд-серверов
  - "localhost:8081"
  - "localhost:8082"
  - "localhost:8083"

health_check:
  interval_seconds: 10s     # Интервал проверки здоровья
  timeout_seconds: 5s       # Таймаут проверки
  path: "/health"           # Путь для проверки здоровья

rate_limiter:
  enabled: true             # Включить rate limiting
  default_capacity: 100     # Стандартная емкость бакета
  default_rate_per_second: 10 # Стандартная скорость пополнения
  client_overrides:         # Специфичные настройки для клиентов
    - client_id: "special-client"
      capacity: 200
      rate_per_second: 20

log_file: ""               # Путь к файлу логов (пусто - stdout)
log_level: "debug"         # Уровень логирования
```

## Архитектура и ключевые компоненты

### Основные интерфейсы

1. `Balancer` - интерфейс балансировщика:
```go
type Balancer interface {
    Next() (string, error)
    Update([]string)
}
```
2. `RateLimiter` - интерфейс ограничителя скорости:
```go
type RateLimiter interface {
    Allow(string) bool
}
```
### Компоненты

1. **Балансировщик нагрузки**:

    - Поддерживает стратегию round-robin

    - Обновляет список доступных серверов через health checker

    - Работает конкурентно безопасно

2. **Health Checker**:

    - Периодически проверяет доступность бэкендов

    - Поддерживает кастомные интервалы и таймауты

    - Уведомляет балансировщик об изменениях

3. **Rate Limiter**:

    - Реализует алгоритм token bucket

    - Поддерживает специфичные настройки для разных клиентов

    - Автоматически очищает неиспользуемые бакеты

4. **Конфигурация**:

    - Горячая перезагрузка при изменении файла

    - Подписка на изменения конфигурации

    - Установка значений по умолчанию

5. **HTTP сервер**:

    - Грейсфул шатдаун

    - Middleware для rate limiting

    - Проксирование запросов


## Тестирование

Интеграционные тесты запускают мок-серверы и балансировщик, проверяя их взаимодействие:
```bash
go test -v ./tests/...
```
